<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Money Tracker</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
    font-family: Arial;
    background: linear-gradient(135deg,#0f2027,#203a43,#2c5364);
    color:white;
    text-align:center;
    padding:30px;
}
.container{
    background:#1b2a35;
    padding:20px;
    border-radius:15px;
    width:500px;
    margin:auto;
    box-shadow:0 0 20px #00ffcc;
}
input, select, button{
    padding:8px;
    margin:5px;
    border:none;
    border-radius:8px;
}
button{
    cursor:pointer;
    font-weight:bold;
}
.add-btn{
    background:#00c853;
    color:white;
}
.add-btn:hover{
    background:#00e676;
}
.reset-btn{
    background:#ff1744;
    color:white;
}
.reset-btn:hover{
    background:#ff5252;
}
.edit-btn{
    background:#ffc107;
}
.delete-btn{
    background:#ff1744;
    color:white;
}
.history{
    margin-top:15px;
    text-align:left;
    max-height:200px;
    overflow:auto;
}
.status{
    font-size:18px;
    margin-top:10px;
    font-weight:bold;
}
.item{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:5px;
}
canvas{
    margin-top:20px;
}
</style>
</head>

<body>

<h1>üí∞ Money Tracker</h1>

<div class="container">

<input type="number" id="amount" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô">

<select id="type" onchange="updateCategoryOptions()">
    <option value="income">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</option>
    <option value="expense">‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</option>
</select>

<select id="category"></select>

<input type="month" id="month" onchange="updateUI()">

<br>
<button onclick="addTransaction()" class="add-btn">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
<button onclick="resetData()" class="reset-btn">‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>

<div class="status" id="status"></div>
<div class="history" id="history"></div>

<canvas id="mainChart"></canvas>
<canvas id="categoryChart"></canvas>

</div>

<script>

let transactions = JSON.parse(localStorage.getItem("transactions")) || [];
let mainChart, categoryChart;

function saveData(){
    localStorage.setItem("transactions", JSON.stringify(transactions));
}

function updateCategoryOptions(){
    let type = document.getElementById("type").value;
    let categorySelect = document.getElementById("category");
    categorySelect.innerHTML = "";

    let incomeCategories = ["‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô","‡∏á‡∏≤‡∏ô‡πÄ‡∏™‡∏£‡∏¥‡∏°","‡∏Ç‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á","‡πÇ‡∏ö‡∏ô‡∏±‡∏™","‡∏≠‡∏∑‡πà‡∏ô ‡πÜ"];
    let expenseCategories = ["‡∏≠‡∏≤‡∏´‡∏≤‡∏£","‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á","‡∏ö‡∏±‡∏ô‡πÄ‡∏ó‡∏¥‡∏á","‡∏Ñ‡πà‡∏≤‡∏ô‡πâ‡∏≥‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü","‡∏≠‡∏∑‡πà‡∏ô ‡πÜ"];

    let categories = type === "income" ? incomeCategories : expenseCategories;

    categories.forEach(cat=>{
        let option = document.createElement("option");
        option.value = cat;
        option.textContent = cat;
        categorySelect.appendChild(option);
    });
}

function addTransaction(){
    let amount = Number(document.getElementById("amount").value);
    let type = document.getElementById("type").value;
    let category = document.getElementById("category").value;
    let month = document.getElementById("month").value;

    if(amount <= 0 || !month) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö");

    transactions.push({amount,type,category,month});
    saveData();
    updateUI();
    document.getElementById("amount").value = "";
}

function updateUI(){

    let historyDiv = document.getElementById("history");
    historyDiv.innerHTML = "";

    let selectedMonth = document.getElementById("month").value;

    let income = 0;
    let expense = 0;
    let categoryData = {};

    transactions
    .filter(t=> t.month === selectedMonth)
    .forEach((t,index)=>{

        let item = document.createElement("div");
        item.className="item";

        let text = document.createElement("span");
        text.innerHTML = `${t.type=="income"?"üíµ":"üí∏"} ${t.category} - ${t.amount} ‡∏ö‡∏≤‡∏ó`;

        let btnGroup = document.createElement("span");

        let editBtn = document.createElement("button");
        editBtn.innerText="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç";
        editBtn.className="edit-btn";
        editBtn.onclick=()=>editTransaction(index);

        let deleteBtn = document.createElement("button");
        deleteBtn.innerText="‡∏•‡∏ö";
        deleteBtn.className="delete-btn";
        deleteBtn.onclick=()=>deleteTransaction(index);

        btnGroup.appendChild(editBtn);
        btnGroup.appendChild(deleteBtn);

        item.appendChild(text);
        item.appendChild(btnGroup);

        historyDiv.appendChild(item);

        if(t.type=="income") income+=t.amount;
        else{
            expense+=t.amount;
            categoryData[t.category] = (categoryData[t.category]||0) + t.amount;
        }
    });

    analyzeFinance(income,expense);
    drawMainChart(income,expense);
    drawCategoryChart(categoryData);
}

function editTransaction(index){
    let newAmount = prompt("‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô:", transactions[index].amount);
    if(newAmount !== null && newAmount > 0){
        transactions[index].amount = Number(newAmount);
        saveData();
        updateUI();
    }
}

function deleteTransaction(index){
    if(confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ?")){
        transactions.splice(index,1);
        saveData();
        updateUI();
    }
}

function analyzeFinance(income,expense){
    let status = document.getElementById("status");
    let balance = income - expense;

    if(balance > 1000){
        status.innerHTML = "üü¢ ‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏î‡∏µ‡∏°‡∏≤‡∏Å ‡πÄ‡∏´‡∏•‡∏∑‡∏≠ " + balance + " ‡∏ö‡∏≤‡∏ó";
    }else if(balance >= 0){
        status.innerHTML = "üü° ‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÄ‡∏á‡∏¥‡∏ô ‡πÄ‡∏´‡∏•‡∏∑‡∏≠ " + balance + " ‡∏ö‡∏≤‡∏ó";
    }else{
        status.innerHTML = "üî¥ ‡∏ï‡∏¥‡∏î‡∏•‡∏ö " + Math.abs(balance) + " ‡∏ö‡∏≤‡∏ó";
    }
}

function drawMainChart(income,expense){
    if(mainChart) mainChart.destroy();
    mainChart = new Chart(document.getElementById("mainChart"), {
        type: 'doughnut',
        data: {
            labels: ['‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö','‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢'],
            datasets: [{
                data: [income, expense],
                backgroundColor: ['#00e676','#ff1744']
            }]
        }
    });
}

function drawCategoryChart(categoryData){
    if(categoryChart) categoryChart.destroy();
    categoryChart = new Chart(document.getElementById("categoryChart"), {
        type: 'bar',
        data: {
            labels: Object.keys(categoryData),
            datasets: [{
                label: '‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏ï‡∏≤‡∏°‡∏´‡∏°‡∏ß‡∏î',
                data: Object.values(categoryData),
                backgroundColor: '#00b0ff'
            }]
        }
    });
}

function resetData(){
    if(confirm("‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?")){
        localStorage.removeItem("transactions");
        transactions = [];
        updateUI();
    }
}

updateCategoryOptions();
updateUI();

</script>

</body>
</html>

